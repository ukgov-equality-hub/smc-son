{% extends 'base.html' %}
{% from 'menu/area-search.html' import areasearch %}
{% block title %}Social Mobility Commission{% endblock %}

{% block backLink %}
<a href="/" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}
<div class="govuk-grid-row govuk-grid-row-full-width">
    <h1 class="govuk-heading-m govuk-!-static-margin-top-4 govuk-!-static-margin-bottom-7">
        State of the Nation 2023: data about social mobility in the UK
    </h1>
    <p class="govuk-body">
        State of the Nation is an annual report into social mobility in the UK. It uses original data and analysis from ​​the Social Mobility Commission (SMC).
    </p>
    <p class="govuk-body">
        State of the Nation uses the SMC’s own measurement framework, the <span class="govuk-!-font-weight-bold">Social Mobility Index</span>.
    </p>

    <h3 class="govuk-heading-s govuk-!-static-margin-top-8">
        Highlighted data
    </h3>
    <div class="grid grid3 grid-home">
        <div class="govuk-body">
            <h3 class="govuk-heading-s">Mobility outcomes</h3>
            <div class="chart-container">
                <div id="chart1"></div>
            </div>
            <p class="govuk-body">Between 1991 and 2020, relative educational mobility went up for people aged 28 to 37 years.</p>
            <a href="/mobility_outcomes" class="govuk-link">Read more...</a>
        </div>
        <div class="govuk-body">
            <h3 class="govuk-heading-s">Intermediate outcomes</h3>
            <div class="chart-container">
                <div id="chart2"></div>
            </div>
            <p class="govuk-body">Data for the period from 2019 to 2021 shows that higher levels of education among 25 to 29 year olds led to higher earnings.</p>
            <a href="/intermediate_outcomes" class="govuk-link">Read more...</a>
        </div>
        <div class="govuk-body">
            <h3 class="govuk-heading-s">Drivers of social mobility</h3>
            <div class="chart-container">
                <div id="chart3"></div>
            </div>
            <p class="govuk-body">More young people aged 19 years are enrolled in education than ever before and the UK has now reached the OECD average.</p>
            <a href="/drivers_of_social_mobility" class="govuk-link">Read more...</a>
        </div>
    </div>

    <h3 class="govuk-heading-s govuk-!-static-margin-top-8">
        Find data by region
    </h3>
    <p class="govuk-body">
        In 2023, we have delivered on our plan to break indicators down by geography. The regions that we use are part of a system developed by the Office for National Statistics (ONS), known as International Territorial Levels (ITLs).
    </p>
    <div class="grid grid3 grid-home">
        <div class="govuk-body double-width">
            {{ areasearch(0, menu, '', 'null') }}
        </div>
        <div class="govuk-body">
            <h3 class="govuk-heading-s">Featured region</h3>
            <div class="map-container">
                <div id="map" class="map"></div>
            </div>
            <a id="featured-region" href="#" class="govuk-link"></a>
        </div>
    </div>

    <p class="govuk-body govuk-!-static-margin-top-5 govuk-!-static-margin-bottom-8">
        Read the <a href="#" class="govuk-link">full State of the Nation 2023 report</a> on GOV.UK.
    </p>
</div>
<script>
    (async function () {
        const dataUtils = new DataUtils()

        new Chart(
            'chart1',
            `${location.protocol}//${location.host}/static/data/indicators/MO32_overview-20230607.csv`,
            { "height": 205, "type": "liney", "xkey": "Time_period", "ykey": "Value", "sort": "Time_period", "scale": "Ratio", "xgrid": false, "ygrid": true, "xticks": 2, "yticks": 2, "legend": false, "colourScheme": ["#1d70b8"], "margin": [0, 0, 0, 0], "maxLabelLength": 25 }
        )

        new Chart(
            'chart2',
            `${location.protocol}//${location.host}/static/data/indicators/IN351_difference-20230713.csv`,
            { "height": 220, "type": "bary", "xkey": "Category", "ykey": "Value", "zkey": "Category", "scale": "%", "xgrid": false, "ygrid": true, "xticks": -1, "yticks": 2, "legend": false, "colourScheme": ["#5694ca", "#d4351c", "#4c2c92", "#d53880", "#28a197", "#b58840", "#505a5f", "#f499be", "#85994b", "#6f72af"], "margin": [0, 0, 0, 0], "maxLabelLength": 45 }
        )

        new Chart(
            'chart3',
            `${location.protocol}//${location.host}/static/data/indicators/DR23a_overview-20230417.csv`,
            { "height": 205, "type": "liney", "xkey": "Time_period", "ykey": "Value", "zkey": "Area_name", "sort": "Time_period", "xgrid": false, "ygrid": true, "xticks": 2, "yticks": 2, "legend": false, "rotateDomainLabels": false, "colourScheme": ["#5694ca", "#d4351c"], "margin": [0, 0, 0, 0], "maxLabelLength": 35 }
        )

        let mapData = await dataUtils.loadDataFromURL(`${location.protocol}//${location.host}/static/data/indicators/areas.csv`)
        mapData = mapData.data
        const area = mapData[rnd(0, areas.length - 1)]
        area['Value'] = 2
        mapData = [ ...mapData, area ]

        const map = new Choropleth(
            'map',
            `${location.protocol}//${location.host}/static/data/maps/International_Territorial_Level_2_(January_2021)_UK_BUC.json`,
            mapData,
            {
                nameField: 'Area_name',
                valueField: 'Value',
                areaField: 'ITL221NM',
                width: 300,
                height: 240,
                labels: true,
                colourScheme: ['#84b871', '#e1e361'],
                allowZoom: false,
                zoomTo: area.Area_name,
                highlight: area.Area_name
            }
        )

        document.getElementById('featured-region').setAttribute('href', `/social_mobility_by_area/${area.Area_name.toLowerCase().replace(/ /g, '_')}`)
        document.getElementById('featured-region').innerText = area.Area_name

        function rnd(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min)
        }
    })()
</script>
{% endblock %}