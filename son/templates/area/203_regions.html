{% extends 'base.html' %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
    {% set compositeIndexCircleColours = ["#ca0020", "#f4a582", "#ffffbf", "#92c5de", "#0571b0"] %}

    <div id="maincontent" class="govuk-grid-row govuk-grid-row-full-width">
        <div class="grid grid2">
            <div>
                <h1 class="govuk-heading-xl">
                    {{ title }}
                </h1>
                <p class="govuk-body govuk-!-padding-bottom-3">
                    This page shows how {{ title }} is ranked for the following 4 ‘composite’ measures of social mobility:
                </p>
                <ul class="govuk-list govuk-list--bullet">
                    <li>
                        <a href="/intermediate_outcomes/composite_indices/promising_prospects/latest"
                           class="govuk-link">
                            Promising prospects
                        </a>
                        -
                        {{ row_for_region['promising_prospects_group_name'] }}
                        <div class="composite-index-colour-circle"
                             style="background-color: {{ compositeIndexCircleColours[(row_for_region['promising_prospects_group_id'] | int) - 1] }}"></div>
                    </li>
                    <li>
                        <a href="/drivers_of_social_mobility/composite_indices/childhood_conditions/latest"
                           class="govuk-link">
                            Childhood conditions
                        </a>
                        -
                        {{ row_for_region['childhood_conditions_group_name'] }}
                        <div class="composite-index-colour-circle"
                             style="background-color: {{ compositeIndexCircleColours[(row_for_region['childhood_conditions_group_id'] | int) - 1] }}"></div>
                    </li>
                    <li>
                        <a href="/drivers_of_social_mobility/composite_indices/labour_market_opportunities/latest"
                           class="govuk-link">
                            Labour market opportunities
                        </a>
                        -
                        {{ row_for_region['labour_market_opportunities_group_name'] }}
                        <div class="composite-index-colour-circle"
                             style="background-color: {{ compositeIndexCircleColours[(row_for_region['labour_market_opportunities_group_id'] | int) - 1] }}"></div>
                    </li>
                    <li>
                        <a href="/drivers_of_social_mobility/composite_indices/innovation_and_growth/latest"
                           class="govuk-link">
                            Innovation and growth
                        </a>
                        -
                        {{ row_for_region['innovation_and_growth_group_name'] }}
                        <div class="composite-index-colour-circle"
                             style="background-color: {{ compositeIndexCircleColours[(row_for_region['innovation_and_growth_group_id'] | int) - 1] }}"></div>
                    </li>
                </ul>
                <p class="govuk-body">Each of these measures combines data from 3 indicators into a single ‘composite’ score. This provides a more reliable picture of geographical mobility patterns.</p>

                <h2 class="govuk-heading-l">Rankings</h2>
                <p class="govuk-body">
                    For each composite measure,
                    <a href="/social_mobility_by_area#the-41-regions" class="govuk-link">41 regions in the UK</a> are ranked from the lowest to highest values. They are then divided into 5 equally-sized groups (‘quintiles’), from 1 (lowest) to 5 (highest).
                </p>
            </div>
            <div>
                <div class="map-container">
                    <div id="map" class="map"></div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .composite-index-colour-circle {
            display: inline-block;
            vertical-align: middle;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid #505a5f;
        }
    </style>

    <script>
        (async function () {
            let mapData = await new DataUtils().loadDataFromURL('/static/data/by-page/social_mobility_by_area/areas.csv')
            mapData = mapData.data
            const area = mapData.filter(x => x['Area_name'] === '{{ title }}')[0]
            area['Value'] = 2
            mapData = [ ...mapData, area ]

            const map = new Choropleth(
                'map',
                '/static/data/maps/International_Territorial_Level_2_(January_2021)_UK_BUC.json',
                mapData,
                {
                    nameField: 'Area_name',
                    valueField: 'Value',
                    areaField: 'ITL221NM',
                    width: 300,
                    height: 300,
                    labels: true,
                    colourScheme: ['#84b871', '#e1e361'],
                    allowZoom: false,
                    zoomTo: area.Area_name,
                    highlight: area.Area_name
                }
            )
        })()
    </script>
{% endblock %}
